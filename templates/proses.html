<!doctype html>
<html>
  <head>
    <title>Proses Apriori</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </head>
  <body class="bg-light">
    <nav class="navbar navbar-dark bg-dark mb-4">
      <div class="container">
        <a class="navbar-brand" href="/">QUANTITAIVE ASSOCIATION RULES</a>
        <a class="btn btn-sm btn-light" href="{{ url_for('hasil_terakhir') }}"
          >‚Üê Kembali</a
        >
      </div>
    </nav>

    <div class="container">
      <h4 class="mb-3">Tahapan Apriori</h4>

      <!-- ================= PREPROCESSING ================= -->
      <div class="card p-3 mb-4 shadow-sm">
        <h5>Preprocessing</h5>

        {% for title, data in [("Data Awal", pre.awal), ("Setelah Cleaning",
        pre.clean), ("Setelah Diskritisasi", pre.diskrit)] %}
        <button
          class="btn btn-outline-dark w-100 mt-2"
          data-bs-toggle="collapse"
          data-bs-target="#{{ title|replace(' ','') }}"
        >
          {{ title }} ({{ data.values()|list|first|length }} baris)
        </button>
        <div class="collapse mt-2" id="{{ title|replace(' ','') }}">
          <div class="table-responsive">
            <table class="table table-bordered table-sm">
              <thead class="table-dark">
                <tr>
                  {% for col in data.keys() %}
                  <th>{{ col }}</th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
                {% for i in range(data.values()|list|first|length) %}
                <tr>
                  {% for col in data.keys() %}
                  <td>{{ data[col][i] }}</td>
                  {% endfor %}
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        {% endfor %}
      </div>

      <!-- ================= Ck ================= -->
      <div class="card p-3 mb-4 shadow-sm">
        <h5>Candidate Itemset (Ck)</h5>
        {% for key, data in process.items() %}
        <button
          class="btn btn-outline-primary w-100 mt-2"
          data-bs-toggle="collapse"
          data-bs-target="#{{ key }}"
        >
          {{ key }} ({{ data|length }} kandidat)
        </button>
        <div class="collapse mt-2" id="{{ key }}">
          <table class="table table-bordered table-sm">
            <tr class="table-dark">
              <th>Itemset</th>
              <th>Count</th>
              <th>Support</th>
            </tr>
            {% for k,v in data.items() %}
            <tr>
              <td>{{ k }}</td>
              <td>{{ v }}</td>
              <td>{{ "%.3f"|format(v/total_trx) }}</td>
            </tr>
            {% endfor %}
          </table>
        </div>
        {% endfor %}
      </div>

      <!-- ================= Lk ================= -->
      <div class="card p-3 mb-4 shadow-sm">
        <h5>Frequent Itemset (Lk)</h5>
        {% for level, data in L_all.items() %}
        <button
          class="btn btn-outline-success w-100 mt-2"
          data-bs-toggle="collapse"
          data-bs-target="#L{{ level }}"
        >
          L{{ level }} ({{ data|length }} frequent itemset)
        </button>
        <div class="collapse mt-2" id="L{{ level }}">
          <table class="table table-bordered table-sm">
            <tr class="table-dark">
              <th>Itemset</th>
              <th>Count</th>
              <th>Support</th>
            </tr>
            {% for k,v in data.items() %}
            <tr>
              <td>{{ k }}</td>
              <td>{{ v }}</td>
              <td>{{ "%.3f"|format(v/total_trx) }}</td>
            </tr>
            {% endfor %}
          </table>
        </div>
        {% endfor %}
      </div>
    </div>
  </body>
</html>
